package jobJa.myPage.enterprise.controller;


import java.security.Principal;
import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestMapping;

import jobJa.common.vo.ComCodeInfoVO;
import jobJa.common.vo.ComDetCodeInfoVO;
import jobJa.member.vo.EntAprvVO;
import jobJa.member.vo.EnterpriseVO;
import jobJa.myPage.enterprise.service.EntProfileService;
import jobJa.myPage.member.vo.MemberVO;
import jobJa.util.ModelAttributeUtil;
import lombok.extern.slf4j.Slf4j;

@RequestMapping("/enter")
@Slf4j
@Controller
public class EnterMyPage {
	
	@Autowired
	EntProfileService entProfileService;
	
	@Autowired
	ModelAttributeUtil modelAttributeUtil;
	
	// 개인 & 기업 프로필 조회
	@GetMapping("/profile")
	public String detail(Principal principal, Model model) {
		
		String memId = principal.getName();
		log.info("profile -> detail : " + memId);
		
		MemberVO memberVO = this.entProfileService.detail(memId);
		
		EnterpriseVO enterpriseVO = this.entProfileService.entDetail(memId);
		
		// 직급가져오기
		List<ComDetCodeInfoVO> comDetCodeInfoVOList = this.entProfileService.comDetCode();
		
		// 산업군 가져오기
		List<ComCodeInfoVO> comCodeInfoVOList = this.entProfileService.comSector();
		
		// 관심키워드 가져오기
		List<ComDetCodeInfoVO> comDetCodeInfoVOList2 = this.entProfileService.comIntWord();
		
		model.addAttribute("comDetCodeInfoVOList1",comDetCodeInfoVOList);	// 직급
		model.addAttribute("comCodeInfoVOList",comCodeInfoVOList);			// 산업군(직군)
		model.addAttribute("comDetCodeInfoVOList",comDetCodeInfoVOList2);	// 관심키워드
		model.addAttribute("memberVO",memberVO);
		model.addAttribute("enterpriseVO",enterpriseVO);
		
		return "mypageEnt/entProfile";
	}
	
	// 일반 프로필 저장
	@PostMapping("/updatePost")
	public String updatePost(Principal principal, Model model, MemberVO memberVO) {
		
		int result = this.entProfileService.updatePost(memberVO);
		log.info("updatePost => result : "+result);
		
		return "redirect:/enter/profile";
	}
	
	// 기업 프로필 저장
	@PostMapping("/entUpdatePost")
	public String entUpdatePost(Principal principal, Model model,EnterpriseVO enterpriseVO) {
		
		int result = this.entProfileService.entUpdatePost(enterpriseVO);
		log.info("entUpdatePost => result : "+result);
		
		return "enter/profile";
	}
	
}
