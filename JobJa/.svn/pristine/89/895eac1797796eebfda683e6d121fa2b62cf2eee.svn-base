package jobja.mypage.enterprise.controller;


import java.security.Principal;
import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.ResponseBody;

import jobja.common.vo.ComCodeInfoVO;
import jobja.common.vo.ComDetCodeInfoVO;
import jobja.member.vo.EnterpriseVO;
import jobja.mypage.enterprise.service.EntProfileService;
import jobja.mypage.member.vo.MemberVO;
import jobja.util.ModelAttributeUtil;
import lombok.extern.slf4j.Slf4j;

@RequestMapping("/enter")
@Slf4j
@Controller
public class EnterMyPage {
	
	@Autowired
	EntProfileService entProfileService;
	
	@Autowired
	ModelAttributeUtil modelAttributeUtil;

	
	/**
	 * 기업 - 개인 프로필 조회
	 * @param principal
	 * @param model
	 * @return
	 */
	@GetMapping("/entmypage")
	public String list(Principal principal, Model model) {
		
		String memId = principal.getName();
		log.info("profile -> detail : " + memId);
		
		MemberVO memberVO = this.entProfileService.detail(memId);
		
		// 직급가져오기
		List<ComDetCodeInfoVO> comDetCodeInfoVOList = this.entProfileService.comDetCode();
		
		// 산업군 가져오기
		List<ComCodeInfoVO> comCodeInfoVOList = this.entProfileService.comSector();
		// 관심키워드 가져오기
		List<ComDetCodeInfoVO> comDetCodeInfoVOList2 = this.entProfileService.comIntWord();
		
		model.addAttribute("comDetCodeInfoVOList1",comDetCodeInfoVOList);	// 직급
		model.addAttribute("comCodeInfoVOList",comCodeInfoVOList);			// 산업군(직군)
		model.addAttribute("comDetCodeInfoVOList",comDetCodeInfoVOList2);	// 관심키워드
		model.addAttribute("memberVO",memberVO);
		
		return "mypageEnt/entProfile";
	}
	
	/**
	 * 기업 - 개인 프로필 조회
	 * @param principal
	 * @param model
	 * @return
	 */
	@GetMapping("/detail")
	@ResponseBody
	public MemberVO detail(Principal principal, Model model) {
		
		String memId = principal.getName();
		log.info("profile -> detail : " + memId);
		
		MemberVO memberVO = this.entProfileService.detail(memId);
		
		// 직급가져오기
		List<ComDetCodeInfoVO> comDetCodeInfoVOList = this.entProfileService.comDetCode();
		memberVO.setComDetCodeInfoVOList(comDetCodeInfoVOList);
		
		// 산업군 가져오기
		List<ComCodeInfoVO> comCodeInfoVOList = this.entProfileService.comSector();
		// 관심키워드 가져오기
		List<ComDetCodeInfoVO> comDetCodeInfoVOList2 = this.entProfileService.comIntWord();
		
		model.addAttribute("comDetCodeInfoVOList1",comDetCodeInfoVOList);	// 직급
		model.addAttribute("comCodeInfoVOList",comCodeInfoVOList);			// 산업군(직군)
		model.addAttribute("comDetCodeInfoVOList",comDetCodeInfoVOList2);	// 관심키워드
		model.addAttribute("memberVO",memberVO);
		
		return memberVO;
	}

	/**
	 * 일반 프로필 저장
	 * @param principal
	 * @param memberVO
	 * @return
	 */
	@PostMapping("/updatePost")
	public String updatePost(Principal principal, MemberVO memberVO) {
		
		int result = this.entProfileService.updatePost(memberVO);
		
		log.info("updatePost => result : "+result);
		
		return "redirect:/enter/entmypage";
	}
	
	/**
	 * 기업 프로필 조회
	 * @param principal
	 * @return
	 */
	@GetMapping("/entDetail")
	@ResponseBody
	public EnterpriseVO entDetail(Principal principal) {
		
		EnterpriseVO enterpriseVO = entProfileService.entDetail(principal.getName());
		
		// 산업군 가져오기
		List<ComCodeInfoVO> comCodeInfoVOList = entProfileService.comSector();
		enterpriseVO.setComCodeInfoVOList(comCodeInfoVOList);
		
		// 관심키워드 가져오기
		List<ComDetCodeInfoVO> comDetCodeInfoVOList2 = entProfileService.comIntWord();
		enterpriseVO.setComDetCodeInfoVOList(comDetCodeInfoVOList2);
		
		return enterpriseVO;
	}

	/**
	 * 기업 프로필 저장
	 * @param principal
	 * @param memberVO
	 * @return
	 */
	@PostMapping("/entUpdatePost")
	public String entUpdatePost(Principal principal, EnterpriseVO enterpriseVO ) {
		
		int result = this.entProfileService.entUpdatePost(enterpriseVO);
		
		log.info("updatePost => result : "+result);
		return "redirect:/enter/entmypage";
	}
}

