<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<%@ taglib prefix="sec" uri="http://www.springframework.org/security/tags"%>
<%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions"%>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt"%>

<link rel="stylesheet" type="text/css" href="/resources/css/enterprise.css">
<link href="/resources/css/recruitList.css" rel="stylesheet">

<style>

.mypage-body-con {
	background-color: #fff;
	border-radius: 30px;
	padding: 24px;
	height: 800px;
}

.body-sub-title {
	font-size: 24px;
	font-weight: bold;
	margin-bottom: 8px;
}

.title-hr {
	border: 1px solid #ccc;
	margin-bottom: 8px;
}

.recruit-li{
    font-size: 15px;
    font-weight: bold;
}

.empty-title{
	text-align: center;
    font-size: 20px;
    font-weight: bold;
    margin-top: 20%;
    color: tomato;
}

.highlight {
    color: #00c362; 
}

.not-search{
	display: flex;
    justify-content: flex-end;
}

.not-keyword {
    border: 1px solid rgb(212, 212, 212);
    border-radius: 5px;
    cursor: pointer;
    padding: 5px;
}

.not-search-btn {
    align-items: center;
    justify-content: center;
    background-color: white;
    border: 1px solid rgb(212, 212, 212);
    border-radius: 5px;
    padding:5px;
}

.not-keyword:focus {
	 border: 1px solid green;
	 outline: none;
}

.not-search-btn:hover {
	border: 1px solid green;
}

.not-keyword:hover {
	 border: 1px solid green;
}

.date{
	border: 1px solid #c9c9c9;
}

.recruite-cen{
	width: 1060px;
	padding: 20px 0px;
    margin: auto;
}

.rec-list{
	margin-top: 16px;
}

.span-list {
	padding: 0px 20px 0px 20px;
    display: grid;
    align-items: center;
    grid-template-columns: 1fr 1fr 1fr 1fr;
}

.rec-item {
	border: 1px solid #e5e6e9;
    border-radius: 12px;
}

.rec-part2 {
	color: #323438;
    line-height: 22px;
    font-size: 15px;
/*     font-weight: bold; */
    white-space: nowrap;
    margin: 16px 0 16px;
}

.select-form{
	border-color: gray;
    border-radius: 5px;
    width: 140px;
    border: 1px solid #C4C4C4;
    box-sizing: border-box;
    border-radius: 10px;
    padding: 5px 5px;
}

.rec-btn {
    align-items: center;
    justify-content: center;
    background-color: white;
    border: 1px solid rgb(212, 212, 212);
    border-radius: 5px;
    cursor: pointer;
    padding: 5px;
}

.rec-btn:hover{
	background-color: #00c362;
	color: white;
};

.ajax-rec-btn {
    align-items: center;
    justify-content: center;
    background-color: white;
    border: 1px solid rgb(212, 212, 212);
    border-radius: 5px;
    cursor: pointer;
    padding: 8px;
}

.ajax-rec-btn:hover{
	background-color: #00c362;
	color: white;
};

.appList {
	font-size: 14px;
	font-weight: bold;
	cursor: pointer;
	text-align: center;
}

.appList:hover {
	font-size: 18px;
	cursor: pointer;
}

.body-sub-con{
	 height: 680px !important;
}

.not-search{
	display: flex;
    justify-content: flex-end;
}

.not-keyword {
    border: 1px solid rgb(212, 212, 212);
    border-radius: 5px;
    cursor: pointer;
    padding: 5px;
}

.not-search-btn {
    align-items: center;
    justify-content: center;
    background-color: white;
    border: 1px solid rgb(212, 212, 212);
    border-radius: 5px;
    cursor: pointer;
    padding:5px;
}

.not-keyword:focus {
	 border: 1px solid green;
	 outline: none;
}

.not-search-btn:hover {
	border: 1px solid green;
}

.not-keyword:hover {
	 border: 1px solid green;
 }
 
</style>

<!-- 지원자 현황 페이지 -->
<div class="mypage-body-con">
	<div class="sub-title-area">
		<div class="body-sub-title">지원자 목록 <span class="highlight">(${fn:length(recruitVO)})</span></div>
	</div>
	
		<div class="body-sub-con">
			<div class="recruite-cen">

			<div>
				<a href="/entApplicant/appRecruit" type="button" class="rec-btn mb-15">목록</a>
				<button type="button" class="rec-btn mb-15" id="excelDownBtn">EXCEL다운로드</button>
				<input type="hidden" id="recruitNo" value="${applicationVO[0].recruitNo}">
			</div>
			
			<table class="table1">
				<colgroup>
					<col width="10%">
					<col width="25%">
					<col width="30%">
					<col width="15%">
					<col width="20%">
				</colgroup>
				
				<thead>
					<tr>
						<th>지원자번호</th>
						<th>이력서</th>
						<th>자기소개서</th>
						<th>입사지원일</th>
						<th>입사지원 상태</th>
					</tr>
				</thead>
				
			<tbody>
				<c:if test="${fn:length(applicationVO) == 0 }">
	                <tr><td colspan="5" > ※ 지원자가 없습니다 ※ </td></tr>
				</c:if>
				
				<c:forEach var="appVO" items="${applicationVO}">
	               <tr>
	                  <td>${appVO.rnum}</td>
	                  <td>${appVO.resumeNo}</td>
	                  <td>${appVO.ptflNo}</td>
	                  <td><fmt:formatDate value="${appVO.appApplyDt}" pattern="yyyy-MM-dd"/></td>
	                  <td>
		            		<select name="appStateCd" class="select-form">
								<c:forEach var="comDetCdVO" items="${comDetCodeInfoVO}">
									<option value="${comDetCdVO.comDetCd}" <c:if test ="${comDetCdVO.comDetCd eq applicationVO[0].appStateCd}">selected="selected"</c:if> 
									>${comDetCdVO.comDetCdNm}</option>
								</c:forEach>
							</select>
							<button type="submit" id="rec-save-btn" class="rec-btn" data-app-no="${appVO.appNo}">저장</button>
	                  </td>
	                  
	               </tr>
            </c:forEach>
 				
	 			</tbody>
	 		</table>

			<div class="pagez mt-30">
				${data.getPagingArea7()}
			</div>
		
		<div id="endList"></div>
		</div>
	</div>
</div>

<script type="text/javascript">
$(function(){
	
	$(document).on("click","#rec-save-btn",function(){
		//data-app-no=
		let appNo = $(this).data("appNo");
		console.log("appNo : " + appNo);
		let appStateCd = $(this).prev().val();
		console.log("appStateCd : " + appStateCd);
		
		let data = {
			"appNo":appNo,
			"appStateCd":appStateCd
		};
		
		console.log("data : ",data);
		
		$.ajax({
			url:"/entApplicant/appUpdate",
			contentType:"application/json; charset=utf-8",
			data:JSON.stringify(data),
			type:"post",
			dateType:'text',
			beforeSend:function(xhr){
				xhr.setRequestHeader("${_csrf.headerName}","${_csrf.token}");
			},
	        success: function(result) {
	        	
	        	console.log("result : "+result);
	        	
	        	if(result=="1"){
	        		alert("변경이 완료되었습니다.");
	        	}
	        }
		});
	});//end $(document).on("click","#rec-save-btn",function(){
	
	
	$(document).on('click','#excelDownBtn',function(){
		
		let recruitNo = $('#recruitNo').val();
		
		console.log("recruitNoㅇㅇㅇㅇ : " + recruitNo);
		
		location.href="/entApplicant/excell?recruitNo="+recruitNo;
		
		
		
	});

	
}); // function end

</script>
