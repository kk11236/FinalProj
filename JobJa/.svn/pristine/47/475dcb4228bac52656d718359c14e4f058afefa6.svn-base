<%@ page language="java" contentType="text/html; charset=UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<%@ taglib prefix="tiles" uri="http://tiles.apache.org/tags-tiles"%>
<%@ taglib prefix="sec" uri="http://www.springframework.org/security/tags"%>
<%@ taglib prefix="form" uri="http://www.springframework.org/tags/form"%>

<script type="text/javascript" src="/resources/js/func.js"></script>
<script type="text/javascript" src="/resources/js/jquery-3.6.0.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/izimodal/1.6.1/js/iziModal.min.js"></script>
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/izimodal/1.6.1/css/iziModal.css">
<link href="/resources/css/myPageaside.css" rel="stylesheet">

<style>
.page-ct {
	background-color: white;
	border-radius: 30px;
}

ul , {
margin:0;

padding:0;
}
ul {
	display: grid;
	grid-template-columns: 1fr 1fr 1fr;
	text-align: center;
}

.page-ct ul li a {
	display: block;
	padding: 10px 0px;
}

.search-Box {
	padding-top: 30px;
	padding-bottom: 10px;
}

.btn-keyword {
	background-color: white;
	border: 1px solid rgb(212, 212, 212);
	border-radius: 5px;
	cursor: pointer;
	padding: 0 13px;
	height: 28px;
}

.page-main-box {
	border-radius: 30px;
	display: grid;
	grid-template-columns: 1fr 2fr;
	gap: 20px;
	margin-bottom: 30px;
}

.inner-box {
	background-color: white;
	border-radius: 24px;
	height: 320px;
	padding: 40px 30px;
}

.inner-box:hover {
	background-color: white;
	border-radius: 24px;
	height: 320px;
	padding: 40px 30px;
	border: 1px solid #5b72ec;
}

.sub-title {
	display: flex;
	align-items: center;
}

.sub-title span {
	color: #5b72ec !important;
}

.box-info {
	display: flex;
	justify-content: space-between;
}

.interView-img img {
	width: 98px;
	height: 98px;
	border-radius: 30px;
	object-fit: cover;
}

.title-hr {
	margin: 8px 0px;
	width: 20px;
}

.title-bold {
	font-weight: 800;
	font-size: 20px;
	width: 275px;
	margin-bottom: 30px;
}

.list-text-small {
	color: #888;
	font-size: 13px;
	font-weight: 500;
}

.list-text-small-name {
	color: #888;
	font-size: 13px;
	margin: 2px 0px;
}

.keyword {
	width: 230px;
	display: inline-block;
	padding-left: 10px;
	box-sizing: border-box;
	color: #888;
	letter-spacing: -1px;
	border: 1px solid #ddd;
	border-right: 0 none;
	padding: 0 11px 1px 11px;
	height: 32px;
	font-size: 13px;
	line-height: 28px;
	vertical-align: middle;
	background: #fff;
}

.btn-keyword {
	padding-bottom: 4px;
	height: 32px;
	border: 0;
	cursor: pointer;
	box-sizing: border-box;
	background-color: #6d82f3;
	color: #fff;
	font-size: 13px;
	font-weight: bold;
	vertical-align: top;
	width: 52px;
	border-radius: 0px;
	margin-left: -4px;
}

.btn-keyword-write {
	background-color: white;
	border: 1px solid rgb(212, 212, 212);
	border-bottom: 30px;
	border-radius: 5px;
	cursor: pointer;
	padding: 0 13px;
	height: 28px;
	padding-bottom: 4px;
	cursor: pointer;
	box-sizing: border-box;
	background-color: #6d82f3;
	color: #fff;
	font-size: 13px;
	font-weight: bold;
	vertical-align: top;
	width: 80px;
	border-radius: 0px;
	margin-left: -4px;
	margin-bottom: 30px;
}


.inner-box2 {
	position: relative;
	background-color: white;
	border-radius: 24px;
	height: 320px;
    padding-left: 20px;
    padding-top: 30px;
    padding-right: 20px
}

.inner-box2:hover {
	background-color: white;
	border-radius: 24px;
	height: 320px;
	padding: 40px 30px;
	border: 1px solid #5b72ec;
}

.sub-title .interView-img {
	margin-left: auto;
}

/* 페이지네이션 가로 정렬 */
.pagination {
	display: flex;
	list-style: none;
	padding-left: 45%;
}

.pagez  li.is_active {
	font-weight: bold;
	border-bottom: 3px solid #2ecc71;
}

.pagez .pagination a {
	display: inline-block;
	color: #222;
}

.pagez .pagination ul {
	margin: 0;
	padding: 0;
	list-style-type: none;
	display: flex;
	justify-content: center;
}

.pagez.pagination {
	padding: 30px 0;
}

.pagez .paginate_button {
	margin: 0 15px;
}

.pagez  .disabled {
	pointer-events: none;
	cursor: default;
}

.pagez  .disabled a {
	color: #ccc;
}

#modal-preview {
	display:none;
	height:600px!important;
}

.goPayment {
    position: absolute;
    bottom: 0;
    right: 0;
    padding-right:20px;
    padding-bottom:20px;
}

</style>

<div class="cen" style="margin: 50px auto;">
	<p class="main-h1">취업 상담</p>

	<div class="search-Box" style="text-align: right;">
		<div>
			<a href="/boardConsulting/create"><button type="button"
					class="btn-keyword-write">글 쓰기</button></a>
		</div>

		<form action="#" name="frm" method="get">
			<input type="text" class="keyword" name="keyword"
				placeholder="검색어를 입력해주세요." />
			<button type="submit" class="btn-keyword">검색</button>
		</form>
	</div>

	<c:forEach var="boardEmplConsultVO" items="${data}" varStatus="stat">
		<div class="page-main-box">
			<c:if test="${boardEmplConsultVO.memberVO.resumeVOList[stat.index].resumeRep == RRY01002}">
				<div class="inner-box" style="overflow:scroll;">
					<div>
						<div class="sub-title" >
							<span>${boardEmplConsultVO.jobCategoryCd}</span> <span
								class="interView-img"> <img alt="담당자사진"
								src="/resources/images/images.jpeg">
							</span>
						</div> <!-- 					<hr class="title-hr"/> -->
						<div class="title-bold">${boardEmplConsultVO.memberVO.memIntrcn}</div>
						<div class="box-info">
							<div class="text-detail">
								<c:forEach var="careerVO" items="${boardEmplConsultVO.memberVO.resumeVOList[0].careerVOList}">
									<p>회사명 : ${careerVO.companyNm}</p>
								</c:forEach>
							</div>
							<div class="" onclick="showProfile()">프로필 보기</div>
							<input type="hidden" value="${boardEmplConsultVO.memberVO.memId}">
							<input type="hidden" value="${boardEmplConsultVO.memberVO.memNm}">
							<input type="hidden" value="${boardEmplConsultVO.memberVO.memTel}">
							<input type="hidden" value="${boardEmplConsultVO.memberVO.memBirth}">
							<input type="hidden" value="${boardEmplConsultVO.memberVO.memGen}">
							<input type="hidden" value="${boardEmplConsultVO.memberVO.memEmail}">
						</div>
					</div>
				</div>
			</c:if>

			<div class="inner-box2">
				<a href="/boardConsulting/detail?boardId=${boardEmplConsultVO.boardId}">
					<div class="sub-title">${boardEmplConsultVO.boardTitle}</div>
					<div>${boardEmplConsultVO.boardCntnt}</div> <!-- 			<img alt="담당자사진" src="/resources/images/images.jpeg"> -->
				</a>
				<div class="goPayment">
					<button type="button" id="go-Payment">결제하기</button>
					<input type="hidden" value="${boardEmplConsultVO.memberVO.memId}">
				</div>
			</div>
		</div>
	</c:forEach>
	<div class="pagez">${info.getPagingArea()}</div>
</div>

<div id="modal-preview">

	<span class="interView-img"> 
		<img alt="담당자사진" src="/resources/images/images.jpeg">
	</span>
	
   	<section>	
        <button data-izimodal-close="" class="icon-close"></button>
        <p class="bold p-20 mb-25">회원 정보</p>

		<div class="mb-12 p-15 detail-one-line">
			아이디 : <input type="text" id="memId" class="bold" value="" readonly>	 
			<p class="memId"></p>
		</div>
		
		<div class="mb-12 p-15 detail-one-line">
			이름 : <input type="text" id="memNm" class="bold" value="" readonly>
			<p class="memNm"></p>
		</div>
		
		<div class="mb-12 p-15 detail-one-line">
			전화번호 : <input type="text" id="memTel" class="bold" value="" readonly>
			<p class="memTel"></p>
		</div>
		
		<div class="mb-12 p-15 detail-one-line">
			생년월일 : <input type="text" id="memBirth" class="bold" value="" readonly>
			<p class="memBirth"></p>
		</div>
		
		<div class="mb-12 p-15 detail-one-line">
			성별 : <input type="text" id="memGen" class="bold" value="" readonly>
			<p class="memGen"></p>
		</div>
		
		<div class="mb-12 p-15 detail-one-line">
			이메일 : <input type="text" id="memEmail" class="bold" value="" readonly>  
			<p class="memEmail"></p>
		</div>
	
		<div class="h-div-line" style="width:95%; margin:35px 0;"></div>
		<div>
		    <button type="button" id="btnChat">채팅하기</button>
		    <input type="hidden" value="${boardEmplConsultVO.memberVO.memId}">
		</div>
    </section>
</div>

<script type="text/javascript">

	function showProfile() {
		
   		$("#modal-preview").iziModal({
   			title : '',
   			subtitle : '',
   			headerColor : '#88A0B9',
   			background : null,
   			theme : '', // light
   			icon : null,
   			iconText : null,
   			iconColor : '',
   			rtl : false,
   			width : 700,
   			height : 1000,
   			top : null,
   			bottom : null,
   			borderBottom : true,
   			padding : 0,
   			radius : 3,
   			zindex : 999,
   			iframe : false,
   			iframeHeight : 400,
   			iframeURL : null,
   			focusInput : true,
   			group : '',
   			loop : false,
   			arrowKeys : true,
   			navigateCaption : true,
   			navigateArrows : true, // Boolean, 'closeToModal', 'closeScreenEdge'
   			history : false,
   			restoreDefaultContent : false,
   			autoOpen : 0, // Boolean, Number
   			bodyOverflow : true,
   			fullscreen : false,
   			openFullscreen : false,
   			closeOnEscape : true,
   			closeButton : true,
   			appendTo : 'body', // or false
   			appendToOverlay : 'body', // or false
   			overlay : true,
   			overlayClose : true,
   			overlayColor : 'rgba(0, 0, 0, 0.4)',
   			timeout : false,
   			timeoutProgressbar : false,
   			pauseOnHover : false,
   			timeoutProgressbarColor : 'rgba(255,255,255,0.5)',
   			transitionIn : 'comingIn',
   			transitionOut : 'comingOut',
   			transitionInOverlay : 'fadeIn',
   			transitionOutOverlay : 'fadeOut',
   			onFullscreen : function() {
   			},
   			onResize : function() {
   			},
   			onOpening : function() {
   			},
   			onOpened : function() {
   			},
   			onClosing : function() {
   			},
   			onClosed : function() {
   			},
   			afterRender : function() {
   			}
   		});
   		
		let el = event.target;
		let siblings = $(el).nextAll();
		
		let memId = siblings[0].value;
		let memNm = siblings[1].value;
		let memTel = siblings[2].value;
		let memBirth = siblings[3].value;
		let memGen = siblings[4].value;
		let memEmail = siblings[5].value;
		
		if(memGen == 1) {
			$('#memGen').val('남자');
		} else {
			$('#memGen').val('여자');
		}
		
		let lists = memBirth.split(' ');
		let year = lists[5];
		let month = lists[1];
		let day = lists[2];
		
		if(month == "Jan"){
			month = '1';
		} else if (month == 'Feb'){
			month = '2';
		} else if (month == 'Mar'){
			month = '3';
		} else if (month == 'Apr'){
			month = '4';
		} else if (month == 'May'){
			month = '5';
		} else if (month == 'Jun'){
			month = '6';
		} else if (month == 'Jul'){
			month = '7';
		} else if (month == 'Aug'){
			month = '8';
		} else if (month == 'Sep'){
			month = '9';
		} else if (month == 'Oct'){
			month = '10';
		} else if (month == 'Nov'){
			month = '11';
		} else if (month == 'Dec'){
			month = '12';
		}
		
		memBirth = year+"-"+month+"-"+day;
		
   		$('#memId').val(memId);
   		$('#memNm').val(memNm);
   		$('#memTel').val(memTel);
   		$('#memBirth').val(memBirth);
   		$('#memEmail').val(memEmail);
   		
   		$("#modal-preview").iziModal('open');
	}
	
	$(document).on("click", "#btnChat", function() {
		
		// 상담사 프로필에서 가져온 ID
		let memId = $('#go-Payment').next().val();
		
		let data = {
				
			"memId":memId
		}
		
		$.ajax({
            url: "/boardInquiry/chatConsultant",
            contentType: "application/json;charset=utf-8",
            data: JSON.stringify(data), 
            type: "post",
            dataType: "json",
            beforeSend: function(xhr) {
                xhr.setRequestHeader("${_csrf.headerName}", "${_csrf.token}");
            },
            success: function(rst) {
            	
            	if(rst.payRemndrCnt > 0) {
            		
            		window.location.href = "/chatting";
            	} else {
            		
            		alert("결제부터 하고 오세여");
            	}
            	
            }
    	});
		
		
// 		window.location.href = "/chat/create-room";		// 화상채팅
		
	});
	
	$(document).on("click", "#go-Payment", function() {
		
		// 상담사 프로필에서 가져온 ID
		let memId = $(this).next().val();
		
		let data = {
				
			"memId":memId
		}
		
    	$.ajax({
            url: "/boardInquiry/getItemList",
            contentType: "application/json;charset=utf-8",
            data: JSON.stringify(data), 
            type: "post",
            dataType: "json",
            beforeSend: function(xhr) {
                xhr.setRequestHeader("${_csrf.headerName}", "${_csrf.token}");
            },
            success: function(rst) {
            	
            	console.log("rst : ", rst);
            	
            }
    	});
		
	});
	
	

</script>