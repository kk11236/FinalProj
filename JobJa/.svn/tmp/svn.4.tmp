package jobJa.member.controller;

import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.security.crypto.password.PasswordEncoder;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.ResponseBody;

import jobJa.alarm.service.AlarmService;
import jobJa.alarm.vo.AlarmVO;
import jobJa.common.vo.ComCodeInfoVO;
import jobJa.common.vo.ComDetCodeInfoVO;
import jobJa.myPage.member.service.MemberService;
import jobJa.myPage.member.vo.AcademicCareerVO;
import jobJa.myPage.member.vo.CareerVO;
import jobJa.myPage.member.vo.MemberVO;
import jobJa.myPage.member.vo.ResumeVO;
import jobJa.recruit.service.RecruitService;
import jobJa.recruit.vo.RecruitFormVO;
import jobJa.util.ModelAttributeUtil;
import lombok.extern.slf4j.Slf4j;

@Slf4j
@Controller
@RequestMapping("/member")
public class MemberController {

	@Autowired
	MemberService memberService;

	@Autowired
	PasswordEncoder encoder;

	@Autowired
	RecruitService recruitService;

	@Autowired
	ModelAttributeUtil modelAttributeUtil;
	
	@Autowired
	AlarmService alarmService;
	

	@GetMapping("/create")
	public String create(RecruitFormVO recruitFormVO,Model model) {
		
		
		List<ComCodeInfoVO> comCodeInfoVOList = this.recruitService.getComCode();
		
		recruitFormVO.setComCodeInfoVOList(comCodeInfoVOList);
		
		log.info("create -> comCodeInfoVOList" + comCodeInfoVOList);

		model.addAttribute("recruitFormVO", recruitFormVO);
		
		log.info("recruitFormVOzezezez:" + recruitFormVO);
		return "sign-up";
	}

	@PostMapping("/createPost")
	public String createFrom(MemberVO memberVO) {
		
		log.info("createPost -> memberVO : " + memberVO);

		memberVO.setMemPass(encoder.encode(memberVO.getMemPass()));

		log.info("memberVO pass :" + memberVO);

		int result = this.memberService.createPost(memberVO);

		log.info("createPost -> " + result);

		return "redirect:/login";

	}
	
	
	@PostMapping("/saveAlarm")
	@ResponseBody
	public int saveAlarm(@RequestBody AlarmVO alarmVO ) {
		
		log.info("alarmVO -> " + alarmVO);
		
		int result = alarmService.insert(alarmVO);
		
		return result;
		
	}
	

}
